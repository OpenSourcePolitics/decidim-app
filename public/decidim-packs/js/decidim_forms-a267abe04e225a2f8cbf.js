!function(){var e={7782:function(e,n,t){var i={"./decidim/surveys/decidim_surveys.svg":71755};function o(e){var n=r(e);return t(n)}function r(e){if(!t.o(i,e)){var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}return i[e]}o.keys=function(){return Object.keys(i)},o.resolve=r,e.exports=o,o.id=7782},71755:function(e,n,t){"use strict";e.exports=t.p+"media/images/decidim_surveys-5771e3e945ff9473a563.svg"}},n={};function t(i){var o=n[i];if(void 0!==o)return o.exports;var r=n[i]={exports:{}};return e[i](r,r.exports,t),r.exports}t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="/decidim-packs/",function(){"use strict";function e(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function n(e,n){for(var t=0;t<n.length;t++){var i=n[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var i=function(){function t(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e(this,t),this.wrapperField=n.wrapperField,this.controllerFieldSelector=n.controllerFieldSelector,this.dependentInputSelector=n.dependentInputSelector,this.controllerSelector=this.wrapperField.find(this.controllerFieldSelector),this._bindEvent(),this._run()}var i,o,r;return i=t,(o=[{key:"_run",value:function(){var e=this;this.controllerSelector.each((function(n,t){var i=$(t),o=i.is(":checked");i.parents("div.collection-input").find(e.dependentInputSelector).prop("disabled",!o)}))}},{key:"_bindEvent",value:function(){var e=this;this.controllerSelector.on("change",(function(){e._run()}))}}])&&n(i.prototype,o),r&&n(i,r),t}();function o(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function r(e,n){for(var t=0;t<n.length;t++){var i=n[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var a=function(){function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o(this,e),this.wrapperField=n.wrapperField,this._bindEvent(),this._order(),this._normalize()}var n,t,i;return n=e,(t=[{key:"_order",value:function(){var e=$(this.wrapperField).find(".collection-input").length;$(this.wrapperField).find(".collection-input").each((function(n,t){for(var i=$(t).find("input[name$=\\[position\\]]"),o=i.val()?parseInt(i.val(),10):e,r=$(t).next();r.length>0;){var a=r.find("input[name$=\\[position\\]]");o>(a.val()?parseInt(a.val(),10):e)&&r.insertBefore($(t)),r=r.next()}}))}},{key:"_findLastPosition",value:function(){var e=0;return $(this.wrapperField).find(".collection-input").each((function(n,t){var i=$(t).find("input[name$=\\[position\\]]"),o=parseInt(i.val(),10);o>e&&(e=o)})),e}},{key:"_normalize",value:function(){$(this.wrapperField).find(".collection-input .position").each((function(e,n){var t=$(n).parent().find("input[name$=\\[position\\]]");t.val()&&(t.val(e),t.prop("disabled",!1),$(n).html("".concat(e+1,". ")))}))}},{key:"_bindEvent",value:function(){var e=this;$(this.wrapperField).find("input[type=checkbox]").on("change",(function(n){var t=$(n.target).parents("label"),i=t.find(".position"),o=t.find("input[name$=\\[position\\]]"),r=e._findLastPosition();n.target.checked?(o.val(r+1),o.prop("disabled",!1),i.html(r+1)):(o.val(""),o.prop("disabled",!0),i.html("")),e._order(),e._normalize()}))}}])&&r(n.prototype,t),i&&r(n,i),e}();function l(e){return l="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l(e)}function c(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function u(e,n){for(var t=0;t<n.length;t++){var i=n[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function s(e,n,t){return n&&u(e.prototype,n),t&&u(e,t),e}var d=function(){function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};c(this,e),this.wrapperField=n.wrapperField,this.type=n.type,this.conditionQuestion=n.conditionQuestion,this.answerOption=n.answerOption,this.mandatory=n.mandatory,this.value=n.value,this.onFulfilled=n.onFulfilled,this.bindEvent()}return s(e,[{key:"bindEvent",value:function(){this.checkCondition(),this.getInputsToListen().on("change",this.checkCondition.bind(this))}},{key:"getInputValue",value:function(){var e=$(".question[data-question-id='".concat(this.conditionQuestion,"']")),n=e.find("textarea, input[type='text']:not([name$=\\[custom_body\\]])");if(n.length)return n.val();var t=[];return e.find(".radio-button-collection, .check-box-collection").find(".collection-input").each((function(e,n){var i=$(n).find("input[name$=\\[body\\]]");if(i.is(":checked")){var o=$(n).find("input[name$=\\[custom_body\\]]").val(),r=i.val(),a=$(n).find("input[name$=\\[answer_option_id\\]]").val();t.push({id:a,value:r,text:o})}})),t}},{key:"getInputsToListen",value:function(){var e=$(".question[data-question-id='".concat(this.conditionQuestion,"']")),n=e.find("textarea, input[type='text']:not([name$=\\[custom_body\\]])");return n.length?n:e.find(".collection-input").find("input:not([type='hidden'])")}},{key:"checkAnsweredCondition",value:function(e){return"object"!==l(e)?Boolean(e):Boolean(e.some((function(e){return e.value})))}},{key:"checkNotAnsweredCondition",value:function(e){return!this.checkAnsweredCondition(e)}},{key:"checkEqualCondition",value:function(e){var n=this;return!!e.length&&e.some((function(e){return e.id===n.answerOption.toString()}))}},{key:"checkNotEqualCondition",value:function(e){var n=this;return!!e.length&&e.every((function(e){return e.id!==n.answerOption.toString()}))}},{key:"checkMatchCondition",value:function(e){var n=new RegExp(this.value,"i");return"object"!==l(e)?Boolean(e.match(n)):e.some((function(e){return e.text?e.text.match(n):e.value.match(n)}))}},{key:"checkCondition",value:function(){var e=this.getInputValue(),n=!1;switch(this.type){case"answered":n=this.checkAnsweredCondition(e);break;case"not_answered":n=this.checkNotAnsweredCondition(e);break;case"equal":n=this.checkEqualCondition(e);break;case"not_equal":n=this.checkNotEqualCondition(e);break;case"match":n=this.checkMatchCondition(e);break;default:n=!1}this.onFulfilled(n)}}]),e}(),h=function(){function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};c(this,e),this.wrapperField=n.wrapperField,this.conditions={},this.showCount=0,this.initializeConditions()}return s(e,[{key:"initializeConditions",value:function(){var e=this;this.wrapperField.find(".display-condition").each((function(n,t){var i=$(t),o=i.data("id");e.conditions[o]={},e.conditions[o]=new d({wrapperField:e.wrapperField,type:i.data("type"),conditionQuestion:i.data("condition"),answerOption:i.data("option"),mandatory:i.data("mandatory"),value:i.data("value"),onFulfilled:function(n){e.onFulfilled(o,n)}})}))}},{key:"mustShow",value:function(){var e=Object.values(this.conditions),n=e.filter((function(e){return e.mandatory})),t=e.filter((function(e){return!e.mandatory}));return n.length?n.every((function(e){return e.fulfilled})):t.some((function(e){return e.fulfilled}))}},{key:"onFulfilled",value:function(e,n){this.conditions[e].fulfilled=n,this.mustShow()?this.showQuestion():this.hideQuestion()}},{key:"showQuestion",value:function(){this.wrapperField.fadeIn(),this.wrapperField.find("input, textarea").prop("disabled",null),this.showCount++}},{key:"hideQuestion",value:function(){this.showCount?this.wrapperField.fadeOut():this.wrapperField.hide(),this.wrapperField.find("input, textarea").prop("disabled","disabled")}}]),e}();function p(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function f(e,n){for(var t=0;t<n.length;t++){var i=n[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var v=function(){function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};p(this,e),this.wrapperField=n.wrapperField,this.alertElement=n.alertElement,this.controllerFieldSelector=n.controllerFieldSelector,this.controllerCollectionSelector=n.controllerCollectionSelector,this.maxChoices=n.maxChoices,this.controllerSelector=this.wrapperField.find(this.controllerFieldSelector),this._bindEvent(),this._run()}var n,t,i;return n=e,(t=[{key:"_run",value:function(){var e=this,n=this.wrapperField.find(this.controllerCollectionSelector),t=!1;n.each((function(n,i){var o=$(i).find(e.controllerFieldSelector).filter((function(e,n){return $(n).is(":checked")}));t=t||o.length>e.maxChoices})),t?this.alertElement.show():this.alertElement.hide()}},{key:"_bindEvent",value:function(){var e=this;this.controllerSelector.on("change",(function(){e._run()}))}}])&&f(n.prototype,t),i&&f(n,i),e}();$((function(){$(".radio-button-collection, .check-box-collection").each((function(e,n){var t;t={wrapperField:$(n),controllerFieldSelector:"input[type=radio], input[type=checkbox]",dependentInputSelector:"input[type=text], input[type=hidden]"},new i(t)})),$.unique($(".check-box-collection").parents(".answer")).each((function(e,n){var t,i=$(n).data("max-choices");i&&(t={wrapperField:$(n),controllerFieldSelector:"input[type=checkbox]",controllerCollectionSelector:".check-box-collection",alertElement:$(n).find(".max-choices-alert"),maxChoices:i},new v(t))})),$(".sortable-check-box-collection").each((function(e,n){var t;t={wrapperField:$(n)},new a(t)})),$(".answer-questionnaire .question[data-conditioned='true']").each((function(e,n){var t;t={wrapperField:$(n)},new h(t)}));var e=$("form.answer-questionnaire");if(e.length>0){e.find("input, textarea, select").on("change",(function(){e.data("changed",!0)}));var n=e.data("safe-path").split("?")[0];$(document).on("click","a",(function(e){window.exitUrl=e.currentTarget.href})),$(document).on("submit","form",(function(e){window.exitUrl=e.currentTarget.action})),window.addEventListener("beforeunload",(function(t){var i=window.exitUrl,o=e.data("changed");window.exitUrl=null,!o||i&&i.includes(n)||(t.returnValue=!0)}))}})),t(7782)}()}();
//# sourceMappingURL=decidim_forms-a267abe04e225a2f8cbf.js.map